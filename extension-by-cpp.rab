= Improve extension API\n(('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼APIã®æ”¹è‰¯'))

: subtitle
   C++ as better language for extension\n
   (('note:C++ã§æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’é–‹ç™ºã—ã‚„ã™ãã™ã‚‹'))
: author
   Kouhei Sutou
: institution
   ClearCode Inc.
: content-source
   RubyKaigi 2017
: date
   2017-09-18
: allotted-time
   35m
: theme
   .

= Ad1: Silver sponsor

  # img
  # src = images/clear-code-silver-sponsor.png
  # relative_height = 100
  # reflect_ratio = 0.1

== Slide properties

: enable-title-on-image
   false

= Ad2: Red Data Tools

  * Project that provides data processing tools for Ruby\n
    (('note:Rubyç”¨ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ„ãƒ¼ãƒ«ç¾¤ã‚’æä¾›ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ'))
    * https://red-data-tools.github.io/
  * Workshop in afternoon break at the 2nd day (today!)\n
    (('note:2æ—¥ç›®ï¼ˆä»Šæ—¥ï¼ï¼‰ã®åˆå¾Œä¼‘æ†©ä¸­ã«ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ãŒã‚ã‚‹ã‚ˆï¼'))

= Ad3: OSS Gate

  * Project that increases people who join OSS development\n
    (('note:OSSã®é–‹ç™ºã«ç¶™ç¶šçš„ã«å‚åŠ ã™ã‚‹äººã‚’ç¶™ç¶šçš„ã«å¢—ã‚„ã™å–ã‚Šçµ„ã¿'))
    * https://oss-gate.github.io/

= Ad3: OSS Gate

  * Ruby is an OSS\n
    (('note:Rubyã‚‚OSS'))
    * OSS Gate wants to increase people to join Ruby itself and RubyGems development!\n
      (('note:OSS Gateã§ã¯Rubyæœ¬ä½“ã®é–‹ç™ºã‚„å„ç¨®RubyGemã®é–‹ç™ºã«å‚åŠ ã™ã‚‹äººã‚‚å¢—ã‚„ã—ãŸã„ï¼'))

= Ad3: OSS Gate

  * Now, works on Tokyo, Sapporo, Osaka and Kyoto\n
    (('note:ç¾åœ¨ã¯æ±äº¬ãƒ»æœ­å¹Œãƒ»å¤§é˜ªãƒ»äº¬éƒ½ã§æ´»å‹•ä¸­'))
    * If you live at one of them, join "OSS Gate workshop"!\n
      (('note:ã“ã‚Œã‚‰ã®åœ°åŸŸã«ä½ã‚“ã§ã„ã‚‹äººã¯ã€ŒOSS Gateãƒ¯ãƒ¼ã‚¯ã‚·ãƒ§ãƒƒãƒ—ã€ã«å‚åŠ ã—ã‚ˆã†ï¼'))

= Ad3: OSS Gate

  * Wants to work on Hiroshima and other areas all over the world!\n
    (('note:åºƒå³¶ã‚„ä¸–ç•Œä¸­ã®ã„ã‚ã‚“ãªåœ°åŸŸã§æ´»å‹•ã—ãŸã„ï¼'))
    * If you're interested in increasing people who join OSS development, talk to me!\n
      (('note:OSSã®é–‹ç™ºã«å‚åŠ ã™ã‚‹äººãŒå¢—ãˆã‚‹ã“ã¨ã«èˆˆå‘³ã®ã‚ã‚‹äººã¯ç§ã«å£°ã‚’ã‹ã‘ã¦ï¼'))

= Abstract\n(('note:æ¦‚è¦'))

  * Show some approaches to write extensions\n
    (('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã®æ›¸ãæ–¹ã‚’ã„ãã¤ã‹ç´¹ä»‹'))
  * Describe C++ approach deeply\n
    (('note:C++ã‚’ä½¿ã£ãŸæ–¹æ³•ã®è©³ç´°ã‚’èª¬æ˜'))
    * Because I recommend the approach!\n
      (('note:C++ã‚’ä½¿ã£ãŸæ–¹æ³•ãŒä¸€ç•ªã„ã„ã¨æ€ã£ã¦ã„ã‚‹ã‹ã‚‰ï¼'))

= Extension\n(('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼'))

  * Ruby library implemented in C\n
    (('note:Cã§å®Ÿè£…ã•ã‚ŒãŸRubyã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼'))
    * Or in other languages such as\n
      C++ and Objective-C\n
      (('note:C++ã‚„Objective-Cãªã©ä»–ã®è¨€èªã§ã®å®Ÿè£…ã§ã‚‚ã‚ˆã„'))

= Ruby API

  # coderay ruby

  class Sample
    def hello
      "Hello"
    end
  end

= C API

  # coderay c

  #include <ruby.h>

  static VALUE
  rb_sample_hello(VALUE self)
  {
    return rb_str_new_static("Hello");
  }

  void
  Init_sample(void)
  {
    VALUE sample = rb_define_class("Sample", rb_cObject);
    rb_define_method(sample, "hello", rb_sample_hello, 0);
  }

= C++ API

  # coderay cpp

  #include <ruby.hpp>

  void
  Init_sample(void)
  {
    rb::Class("Sample", rb_cObject).
      define_method("hello",
                    [](VALUE self) {
                      return rb_str_new_static("Hello");
                    });
  }

= Ruby API\nwithout syntax sugar\n(('note:ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ãªã—'))

  # coderay ruby

  Sample = Class.new do
    define_method(:hello) do
      "Hello"
    end
  end

= C++ API (reprise)\n(('note:ï¼ˆå†æ²ï¼‰'))

  # coderay cpp

  // Similar to Ruby API without syntax sugar!
  // ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ãªã—ã®Ruby APIã¨ä¼¼ã¦ã„ã‚‹ï¼
  rb::Class("Sample", rb_cObject).
    define_method("hello",
                  [](VALUE self) {
                    return rb_str_new_static("Hello");
                  });

= Why is extension needed?\n(('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ãŒå¿…è¦ãªæ™‚'))

  * Performance(('note:ï¼ˆæ€§èƒ½ï¼‰'))
  * Integration with existing libraries implemented in other languages such as C\n
    (('note:ä»–è¨€èªã§å®Ÿè£…ã•ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’åˆ©ç”¨ã™ã‚‹'))
    * It's called as binding\n
      (('note:ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã‚‚ã®'))

= Performance\n(('note:æ€§èƒ½'))

  * Extension is fast\n
    (('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¯é€Ÿã„'))
    * Because C/C++ is fast\n
      (('note:C/C++ãŒé€Ÿã„ã‹ã‚‰'))
    * Especially loop\n
      (('note:ç‰¹ã«ãƒ«ãƒ¼ãƒ—ã™ã‚‹ã‚„ã¤ãŒé€Ÿã„'))

= Loop: Sum

  # coderay ruby

  numbers = (1..100000).to_a
  # Ruby level loop: 25.1ms
  numbers.inject(&:+)
  # C level loop:     0.5ms
  # 50x fasterï¼ˆ50å€é€Ÿã„ï¼‰
  numbers.sum

= Target use case\n(('note:ã‚ˆãã‚ã‚‹ä½¿ã„æ–¹'))

  * Mostly write your script in Ruby\n
    (('note:ã»ã¨ã‚“ã©ã¯Rubyã§å®Ÿè£…'))
  * Implement only bottle neck as extension\n
    (('note:ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã ã‘æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã¨ã—ã¦å®Ÿè£…'))

= e.g.: Machine Learning\n(('note:ä¾‹ï¼šæ©Ÿæ¢°å­¦ç¿’'))

  * Many array/matrix operations\n
    (('note:é…åˆ—ãƒ»è¡Œåˆ—ã«å¯¾ã™ã‚‹æ¼”ç®—ãŒå¤šã„'))

= Writing ext is difficult\n(('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã®å®Ÿè£…ã¯é›£ã—ã„'))

  * Require C knowledge\n
    (('note:Cã®çŸ¥è­˜ãŒå¿…è¦'))
  * Require Ruby C API knowledge\n
    (('note:Rubyã®C APIã®çŸ¥è­˜ãŒå¿…è¦'))

(('tag:center'))
Most Rubyists don't have them\n
(('note:å¤šãã®Rubyistã¯ã“ã‚Œã‚‰ã®çŸ¥è­˜ãŒãªã„'))

= I don't want to learn...\n(('note:ãã‚“ãªã®çŸ¥ã‚ŠãŸããªã„â€¦'))

You should learnğŸ‘\n
(('note:(if you want more performance)'))\n
(('note:æ€§èƒ½ãŒæ¬²ã—ã„ãªã‚‰çŸ¥ã£ã¦ãŠãã¹ã'))

# ğŸ’
# ğŸ«

= Easy to write ext\n(('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ç°¡å˜ã«å®Ÿè£…ã™ã‚‹æ–¹æ³•'))

  * Assumptions(('note:ï¼ˆå‰æï¼‰'))
    * Ruby knowledge(('note:ï¼ˆRubyã®çŸ¥è­˜ï¼‰'))
    * Ruby C API knowledge(('note:ï¼ˆRubyã®C APIã®çŸ¥è­˜ï¼‰'))
  * Improve Ruby C API(('note:ï¼ˆRubyã®C APIã‚’æ”¹è‰¯ï¼‰'))
    * Ruby C API isn't bad but has some verbosities because of C\n
      (('note:Rubyã®C APIã¯æ‚ªããªã„ã‚“ã ã‘ã©Cãªã®ã§å†—é•·'))

= Approaches(('note:ï¼ˆå®Ÿç¾æ–¹æ³•ï¼‰'))

  * Extend language to support writing extension\n
    (('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«è¨€èªã‚’æ‹¡å¼µ'))
  * Based on not C language\n
    (('note:Cä»¥å¤–ã®è¨€èªã‚’ä½¿ã†'))
    * There are many better C languages\n
      (('note:Cã‚ˆã‚Šä¾¿åˆ©ãªè¨€èªã¯ã„ã‚ã„ã‚ã‚ã‚‹'))
  * Provide convenient API\n
    (('note:ä¾¿åˆ©APIã‚’æä¾›'))

= Extend language\n(('note:è¨€èªã‚’æ‹¡å¼µ'))

  * Rubex: Extended Ruby\n
    (('note:Rubexï¼šRubyã‚’æ‹¡å¼µ'))
  * Cython: Extended Python\n
    (('note:Cythonï¼šPythonã‚’æ‹¡å¼µ'))

= How to run\n(('note:å‹•ã‹ã—æ–¹'))

  * Compile code for extended language to C\n
    (('note:æ‹¡å¼µè¨€èªã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’Cã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«'))
  * Build compiled C code\n
    (('note:ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã•ã‚ŒãŸCã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰'))
  * Load the built extension\n
    (('note:ãƒ“ãƒ«ãƒ‰ã—ãŸæ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’èª­ã¿è¾¼ã‚€'))

= Extended syntax\n(('note:æ‹¡å¼µã•ã‚ŒãŸæ§‹æ–‡'))

  * Type information\n
    (('note:å‹æƒ…å ±ã‚’æ›¸ã‘ã‚‹'))
  * C code snippet\n
    (('note:Cã®ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã‚‹'))

= How to run: Rubex\n(('note:Rubexã®å‹•ã‹ã—æ–¹'))

  # coderay ruby
  # fibonacci.rubex
  class Fibonacci
    # "int" is type information
    def compute(int n)
      # ...
    end
  end

= How to run: Rubex\n(('note:Rubexã®å‹•ã‹ã—æ–¹'))

  # coderay console
  % rubex fibonacci.rubex
  % cd fibonacci
  % ruby extconf.rb
  % make

= How to run: Rubex\n(('note:Rubexã®å‹•ã‹ã—æ–¹'))

  # coderay ruby
  require_relative "fibonacci.so"
  p Fibonacci.new.compute(100)

= Extend language: Pros1\n(('note:æ‹¡å¼µè¨€èªï¼šé•·æ‰€1'))

(('tag:center'))
Friendly syntax for base language users\n
(('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ãªã˜ã¿ã‚„ã™ã„æ§‹æ–‡'))

  * Because most syntaxes are same\n
    (('note:æ§‹æ–‡ã®å¤§éƒ¨åˆ†ã¯åŒã˜ã ã‹ã‚‰'))

= Extend language: Pros\n(('note:æ‹¡å¼µè¨€èªï¼šé•·æ‰€2'))

(('tag:center'))
Easy to migrate from base lang\n
(('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªã‹ã‚‰ã®ç§»è¡ŒãŒå®¹æ˜“'))

  * Because upper compatibility\n
    (('note:ä¸Šä½äº’æ›ã ã‹ã‚‰'))
  * Code for base language works without modification\n
    (('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¯å¤‰æ›´ãªã—ã§å‹•ã'))

= Extend language: Pros\n(('note:æ‹¡å¼µè¨€èªï¼šé•·æ‰€3'))

(('tag:center'))
Don't require large C knowledge\n
(('note:ãã‚“ãªã«Cã®çŸ¥è­˜ã¯å¿…è¦ãªã„'))

  * Most codes can be written with base language knowledge\n
    (('note:ã‚³ãƒ¼ãƒ‰ã®å¤§éƒ¨åˆ†ã¯ãƒ™ãƒ¼ã‚¹ã®è¨€èªã®çŸ¥è­˜ã§æ›¸ã‘ã‚‹'))

= Extend language: Cons1\n(('note:æ‹¡å¼µè¨€èªï¼šçŸ­æ‰€1'))

(('tag:center'))
You realize that it's not friendly syntax when you use it\n
(('note:ä½¿ã†ã¨ãã‚“ãªã«ãªã˜ã¿ã‚„ã™ã„æ–‡æ³•ã§ã¯ãªã„ã¨æ°—ã¥ã'))

  * Small differences will confuse you\n
    (('note:å°ã•ãªé•ã„ãŒã„ã‚ã„ã‚ã‚ã£ã¦ã‚ã‹ã‚Šã«ãã„'))

= Extend language: Cons2\n(('note:æ‹¡å¼µè¨€èªï¼šçŸ­æ‰€2'))

(('tag:center'))
Difficult to debug\n
(('note:ãƒ‡ãƒãƒƒã‚°ãŒé›£ã—ã„'))

  * Need base language, extend language and C knowledge\n
    (('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªã®çŸ¥è­˜ã‚‚æ‹¡å¼µè¨€èªã®çŸ¥è­˜ã‚‚Cã®çŸ¥è­˜ã‚‚å¿…è¦'))

(('note:Cython has GDB integration to solve this problem'))\n
(('note:Cythonã¯ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«GDBç”¨ã®ä¾¿åˆ©æ©Ÿèƒ½ã‚’æä¾›'))

= Extend language: Cons3\n(('note:æ‹¡å¼µè¨€èªï¼šçŸ­æ‰€2'))

(('tag:center'))
Need many works to maintain\n
(('note:(For maintainers, not for users)'))\n
(('note:ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã¯ãªããƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ãŒï¼‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¤§å¤‰'))

  * Base language introduces a new syntax then extend language should implement it\n
    (('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªãŒæ–°ã—ã„æ§‹æ–‡ã‚’å°å…¥â†’æ‹¡å¼µè¨€èªã§ã‚‚å®Ÿè£…'))

= Based on not C language\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹'))

  * JRuby: Java + Ruby
  * Helix: Rust + Ruby

= How to run: JRuby\n(('note:JRubyã§ã®å‹•ã‹ã—æ–¹'))

  # coderay java
  // Fibonacci.java
  public class Fibonacci {
    public long[] compute(int n) {
      // ...
    }
  }

= How to run: JRuby\n(('note:JRubyã§ã®å‹•ã‹ã—æ–¹'))

  # coderay console
  % javac Fibonacci.java
  % jar cf fibonacci.jar Fibonacci.class

= How to run: JRuby\n(('note:JRubyã§ã®å‹•ã‹ã—æ–¹'))

  # coderay ruby
  require "fibonacci.jar"
  java_import "Fibonacci"
  p Fibonacci.new.compute(100)

= Based on not C: Pros1\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼šé•·æ‰€1'))

(('tag:center'))
Easy to write than C\n
(('note:Cã‚ˆã‚Šæ›¸ãã‚„ã™ã„'))

  * Simpler syntax\n
    (('note:æ´—ç·´ã•ã‚ŒãŸæ§‹æ–‡'))
  * Rich features than C\n
    (('note:Cã‚ˆã‚Šæ©Ÿèƒ½ãŒå¤šã„'))

= Based on not C: Pros2\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼šé•·æ‰€2'))

(('tag:center'))
Can use libraries in base language\n
(('note:ãƒ™ãƒ¼ã‚¹è¨€èªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’ä½¿ãˆã‚‹'))

  * Major languages have many libraries\n
    (('note:åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹è¨€èªã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚‚å¤šã„'))

= Based on not C: Cons1\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼šçŸ­æ‰€1'))

(('tag:center'))
Need base language knowledge\n
(('note:ãƒ™ãƒ¼ã‚¹è¨€èªã®çŸ¥è­˜ãŒå¿…è¦'))

  * Java for JRuby(('note:ï¼ˆJRubyãªã‚‰Javaï¼‰'))
  * Rust for Helix(('note:ï¼ˆHelixãªã‚‰Rustï¼‰'))

= Based on not C: Cons2\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼šçŸ­æ‰€2'))

(('tag:center'))
May need C knowledge\n
(('note:(When Ruby implementation is MRI)'))\n
(('note:Rubyã®å®Ÿè£…ãŒMRIãªã‚‰Cã®çŸ¥è­˜ãŒå¿…è¦ã‹ã‚‚ã—ã‚Œãªã„'))

  * Base language wraps Ruby C API\n
    (('note:ãƒ™ãƒ¼ã‚¹ã®è¨€èªã¯Rubyã®C APIã‚’ãƒ©ãƒƒãƒ—ã—ã¦ã„ã‚‹'))
    * e.g.: (({sys::RSTRING_PTR})) on Helix\n
      (('note:ä¾‹ï¼šHelixãªã‚‰sys::RSTRING_PTRãŒãƒ©ãƒƒãƒ—ã—ãŸAPI'))

= Based on not C: Cons3\n(('note:Cè¨€èªä»¥å¤–ã‚’ãƒ™ãƒ¼ã‚¹ã«ã™ã‚‹ï¼šçŸ­æ‰€3'))

(('tag:center'))
May need many works to maintain\n
(('note:(When Ruby implementation is MRI)'))\n
(('note:Rubyã®å®Ÿè£…ãŒMRIãªã‚‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãŒå¤§å¤‰ã‹ã‚‚'))

  * Ruby introduces a new API then base language may need to implement it\n
    (('note:RubyãŒæ–°ã—ã„APIã‚’è¿½åŠ â†’ãƒ™ãƒ¼ã‚¹è¨€èªã§ã‚‚å®Ÿè£…ï¼Ÿ'))
    * e.g.: (({rb_gc_adjust_memory_usage()}))

= Provide convenient API\n(('note:ä¾¿åˆ©ãªAPIã‚’æä¾›'))

  * Rice: C++ + Ruby
  * Ext++: C++ + Ruby
  * Boost.Python: C++ + Python
  * pybind11: C++11 + Python

= How to run: Rice\n(('note:Riceã®å‹•ã‹ã—æ–¹'))

  # coderay cpp

  #include <rice/Class.hpp>

  static const char * // Not VALUE!
  rb_sample_hello(Rice::Object self) {
    return "Hello";
  }
  extern "C" void Init_sample() {
    Rice::define_class("Sample").
      define_method("hello", &rb_sample_hello);
  }

= How to run: Rice\n(('note:Riceã®å‹•ã‹ã—æ–¹'))

  # coderay ruby

  # extconf.rb
  require "mkmf-rice"
  create_makefile("sample")

= How to run: Rice\n(('note:Riceã®å‹•ã‹ã—æ–¹'))

  # coderay console

  % ruby extconf.rb
  % make

= How to run: Rice\n(('note:Riceã®å‹•ã‹ã—æ–¹'))

  # coderay ruby

  require_relative "sample.so"
  p Sample.new.hello
  # => "Hello"

= Provide C++ API: Pros1\n(('note:C++ APIã‚’æä¾›ï¼šé•·æ‰€1'))

(('tag:center'))
Easy to write than C\n
(('note:Cã‚ˆã‚Šæ›¸ãã‚„ã™ã„'))

  * Auto type conversion\n
    (('note:å‹ã®è‡ªå‹•å¤‰æ›'))
  * Auto exception conversion\n
    (('note:ä¾‹å¤–ã®è‡ªå‹•å¤‰æ›'))

= Provide C++ API: Pros2\n(('note:C++ APIã‚’æä¾›ï¼šé•·æ‰€2'))

(('tag:center'))
Easy to maintain\n
(('note:(For maintainers, not for users)'))\n
(('note:ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã¯ãªããƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ãŒï¼‰ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã‚„ã™ã„'))

  * Can use C directly incl macro\n
    (('note:ãƒã‚¯ãƒ­ã‚‚å«ã‚ã¦Cã®æ©Ÿèƒ½ã‚’ç›´æ¥ä½¿ãˆã‚‹'))
  * Don't need wrapper for C API\n
    (('note:(Wrapped API may be useful)'))\n
    (('note:C APIã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹ã¨ä¾¿åˆ©ã ã‚ã†ã‘ã©ãƒ©ãƒƒãƒ—ã—ãªãã¦ã‚‚ã‚ˆã„'))

= Provide C++ API: Pros3\n(('note:C++ APIã‚’æä¾›ï¼šé•·æ‰€3'))

(('tag:center'))
Easy to debug\n
(('note:if you have C knowledge'))\n
(('note:Cã®çŸ¥è­˜ãŒã‚ã‚‹ãªã‚‰ãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„'))

  * Can use GDB/LLDB directly\n
    (('note:GDB/LLDBã‚’ç›´æ¥ä½¿ãˆã‚‹'))
    * GDB/LLDB have built-in C++ support\n
      (('note:GDB/LLDBã¯çµ„ã¿è¾¼ã¿ã§C++ã‚’ã‚µãƒãƒ¼ãƒˆ'))

= Provide C++ API: Cons1\n(('note:C++ APIã‚’æä¾›ï¼šçŸ­æ‰€1'))

(('tag:center'))
Require C and C++ knowledge\n
(('note:Cã¨C++ã®çŸ¥è­˜ãŒå¿…è¦'))

  * Many Rubyists don't have\n
    (('note:å¤šãã®Rubyistã¯ä¸¡æ–¹ã¯çŸ¥ã‚‰ãªã„'))

= Provide C++ API: Cons2\n(('note:C++ APIã‚’æä¾›ï¼šçŸ­æ‰€2'))

(('tag:center'))
C++ is difficult\n
(('note:C++ã¯é›£ã—ã„'))

  * e.g.: Template\n
    (('note:ãŸã¨ãˆã°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ'))

= Provide C++ API: Cons3\n(('note:C++ APIã‚’æä¾›ï¼šçŸ­æ‰€3'))

(('tag:center'))
Slower build\n
(('note:ãƒ“ãƒ«ãƒ‰ãŒé…ã„'))

= Provide C++ API: Cons4\n(('note:C++ APIã‚’æä¾›ï¼šçŸ­æ‰€4'))

(('tag:center'))
Conv from Ruby may be a bother\n
(('note:Rubyå®Ÿè£…ã®ç§»æ¤ãŒé¢å€’'))

  * C++ with convenient Ruby C API needs more codes than Ruby\n
    (('note:Rubyã®C APIã«C++ã®ä¾¿åˆ©APIãŒã‚ã£ã¦ã‚‚Rubyã‚ˆã‚Šã‚‚ãŸãã•ã‚“ã‚³ãƒ¼ãƒ‰ãŒå¿…è¦'))

= From Ruby: Rice\n(('note:Rubyã‹ã‚‰Riceã«ç§»æ¤'))

  # coderay ruby
  def fib(n)
    prev = 1
    current = 1
    1.step(n - 1).collect do
      prev, current = current, current + prev
      prev
    end
  end

= From Ruby: Rice\n(('note:Rubyã‹ã‚‰Riceã«ç§»æ¤'))

  # coderay cpp
  std::vector<uint64_t> fib(Rice::Object self, int n) {
    uint64_t prev = 1, current = 1;
    std::vector<uint64_t> numbers;
    for (int i = 1; i < n; ++i) {
      auto temp = current; current += prev; prev = temp;
      numbers.push_back(prev);
    }
    return numbers;
  }

= Recommended approach\n(('note:ã‚ªã‚¹ã‚¹ãƒ¡ã®å®Ÿç¾æ–¹æ³•'))

  * Extend language to support writing extension\n
    (('note:æ‹¡å¼µãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒ¼ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«è¨€èªã‚’æ‹¡å¼µ'))
  * Based on not C language\n
    (('note:Cä»¥å¤–ã®è¨€èªã‚’ä½¿ã†'))
  * ((*Provide convenient API\n*))
    (('note:ä¾¿åˆ©APIã‚’æä¾›'))

= Reason why recommended\n(('note:ã‚ªã‚¹ã‚¹ãƒ¡ã®ç†ç”±'))

  * Easy to maintain by maintainers\n
    (('note:ãƒ¡ãƒ³ãƒ†ãƒŠãƒ¼ãŒãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã—ã‚„ã™ã„'))
  * Easy to debug by users\n
    (('note:ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‡ãƒãƒƒã‚°ã—ã‚„ã™ã„'))
